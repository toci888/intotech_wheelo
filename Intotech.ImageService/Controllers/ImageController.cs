using System.Collections.Specialized;
using Intotech.ImageService.Pages;
using Microsoft.AspNetCore.Mvc;
using System.Web;
using Intotech.Wheelo.Bll.Persistence;
using Intotech.Wheelo.ImageService.Bll;

namespace Intotech.ImageService.Controllers;

[Controller]
//[Route("/")]
public class ImageController : Controller
{
    private const string QsDataId = "dataId";
    private const string QsType = "type";
    private const string QsQueryValid = "queryValid";

    protected ImageRetrieveLogic ImageRetrieveLogic;

    public ImageController()
    {
        ImageRetrieveLogic = new ImageRetrieveLogic(new AccountLogic()); // skipping di for now
    }
    // GET
    [Route("image")]
    public IActionResult Index()
    {
        NameValueCollection queryStringData = HttpUtility.ParseQueryString(Request.QueryString.Value);

        string dataId = queryStringData[QsDataId];

        int accountId = int.Parse(dataId);

        string imageBase64 = ImageRetrieveLogic.GetImageForUser(accountId, queryStringData[QsQueryValid]);

        return View(new IndexModel()
        {
            ImageBase64 = imageBase64
        });

        //return View(new IndexModel() { ImageBase64 = "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" });
    }
}